environment:
  matrix:
  - TOXENV: py37
  pypitoken:
    secure: Y9Yz4iNYJiWdoFrO7hxMyaDrWAq2E2rWaXGX8iMdCNLJkduZ0Abn/hw5/b8DjyFOQXNo9ddhidb8exiAyLPUmUfRv2qqxzohMLk2Cxg57Tmbvmm11gzqnZW/mbunzIFz9MfA8JEiYkIi58epgFK3d6dPxgEt/tjBu529hCUkvkpznQENy5RIWGlcFiaY7Q/P1AEZHJZ45YVEjwK9fYTZVgP7ubUJ69xSg3/WcaRdmrg=

install:
  - pip install tox
  - set PYTHONPATH=C:\projects\docs-from-tests
  - pip install --user --upgrade setuptools wheel
  - pip install --user --upgrade twine

build_script:
  - python setup.py sdist bdist_wheel

test_script:
  - tox
  # the below is a nicety, it populates the "tests" tab of the appveyor build page,
  # it requires "--junitxml=test-output.xml" to be added to the pytest command

on_finish:
  - ps: ./tests/upload_test_results_to_appveyor.ps1

artifacts:
  - path: dist\*.*
    name: python-package

# deploy python backage for master branch builds, this runs the risk of overwriting 
# a package if the version isn't updated, which is hackily avoided with the 
# --skip-existing parameter
for:
-
  branches:
    only:
      - master
  deploy_script:
    - python -m twine upload -u __token__ -p %pypitoken% --skip-existing dist/*

# the below means that normally only the person that broke the build gets an email, instead of everybody
notifications:
  - provider: Email
    to:
      - '{{commitAuthorEmail}}'
    subject: 'Build {{status}}'
    on_build_success: false
    on_build_failure: true
    on_build_status_changed: false

 